---
// src/components/ads/AdSense.astro
// Componente para mostrar anuncios de Google AdSense con generación automática de slots

export interface Props {
  slot?: string;           // ID del slot de AdSense (opcional - se genera automático)
  format?: string;         // Formato del anuncio (auto, horizontal, vertical, rectangle)
  className?: string;      // Clases CSS adicionales
  style?: string;         // Estilos inline adicionales
  adType?: 'display' | 'in-article' | 'in-feed'; // Tipo de anuncio
  pageType?: string;      // Tipo de página para generar slot automático
  position?: string;      // Posición del anuncio para generar slot único
}

const { 
  slot, 
  format = 'auto', 
  className = '', 
  style = '',
  adType = 'display',
  pageType = '',
  position = ''
} = Astro.props;

// Generar slot automático basado en el tipo de página y posición
const generateAutoSlot = () => {
  // Base del slot (últimos 4 dígitos del publisher ID)
  const baseSlot = '6240430';
  
  // Mapeo de páginas a códigos
  const pageMap = {
    'noticias-list': '1',
    'noticia-single': '2',
    'blog-list': '3',
    'blog-single': '4',
    'home': '5',
    'vinilos': '6',
    'programas': '7'
  };
  
  // Mapeo de posiciones a códigos
  const positionMap = {
    'top': '1',
    'middle': '2',
    'bottom': '3',
    'sidebar': '4',
    'header': '5',
    'after-title': '6',
    'in-content': '7'
  };
  
  const pageCode = pageMap[pageType] || '9';
  const positionCode = positionMap[position] || '9';
  
  // Formato: baseSlot + pageCode + positionCode
  // Ejemplo: 624043012 para noticias-list top
  return baseSlot + pageCode + positionCode;
};

// Usar slot proporcionado o generar automático
const adSlot = slot || generateAutoSlot();

// Configuración según el tipo de anuncio
const adConfig = {
  'display': {
    'data-ad-format': format,
    'data-full-width-responsive': 'true'
  },
  'in-article': {
    'data-ad-layout': 'in-article',
    'data-ad-format': 'fluid'
  },
  'in-feed': {
    'data-ad-format': 'fluid',
    'data-ad-layout-key': '-fb+5w+4e-db+86'
  }
};

const adAttributes = adConfig[adType] || adConfig['display'];
---

<div class={`adsbygoogle-container ${className}`} style={style}>
  <!-- Anuncio de Google AdSense -->
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-6260623796240430"
       data-ad-slot={adSlot}
       {...adAttributes}></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<style>
  .adsbygoogle-container {
    text-align: center;
    margin: 2rem 0;
    min-height: 90px;
    background: rgba(0, 0, 0, 0.02);
    border-radius: 12px;
    padding: 1rem;
    position: relative;
  }
  
  .adsbygoogle-container::before {
    content: 'Publicidad';
    position: absolute;
    top: -10px;
    left: 10px;
    font-size: 0.7rem;
    color: var(--color-text-secondary);
    background: var(--color-bg);
    padding: 0 0.5rem;
    opacity: 0.6;
  }
  
  /* Modo oscuro */
  [data-theme="night"] .adsbygoogle-container {
    background: rgba(255, 255, 255, 0.02);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .adsbygoogle-container {
      margin: 1.5rem 0;
      min-height: 60px;
    }
  }
</style>
