document.addEventListener("DOMContentLoaded",async function(){const l=document.getElementById("gravity-form-container"),y=l?.querySelector(".loading-message"),h=l?.querySelector(".error-message"),E=1;try{const c=await fetch("/api/gravity-form");if(!c.ok)throw new Error(`Error ${c.status}: ${c.statusText}`);const m=await c.json(),a=document.createElement("form");a.id="gravityForm",a.className="contact-form",m.fields.forEach((t,d)=>{const n=document.createElement("div");n.className="form-group",n.style.opacity="0",n.style.transform="translateY(20px)";const s=document.createElement("label");if(s.htmlFor=`input_${t.id}`,s.textContent=t.label+(t.required?" *":""),n.appendChild(s),t.type==="text"||t.type==="name"){const e=document.createElement("input");e.type="text",e.id=`input_${t.id}`,e.name=`input_${t.id}`,e.placeholder=t.placeholder||"",e.required=t.isRequired||!1,n.appendChild(e)}else if(t.type==="email"){const e=document.createElement("input");e.type="email",e.id=`input_${t.id}`,e.name=`input_${t.id}`,e.placeholder=t.placeholder||"",e.required=t.isRequired||!1,n.appendChild(e)}else if(t.type==="phone"){const e=document.createElement("input");e.type="tel",e.id=`input_${t.id}`,e.name=`input_${t.id}`,e.placeholder=t.placeholder||"",e.required=t.isRequired||!1,n.appendChild(e)}else if(t.type==="textarea"){const e=document.createElement("textarea");e.id=`input_${t.id}`,e.name=`input_${t.id}`,e.placeholder=t.placeholder||"",e.required=t.isRequired||!1,e.rows=5,n.appendChild(e)}else if(t.type==="select"&&t.choices){const e=document.createElement("select");e.id=`input_${t.id}`,e.name=`input_${t.id}`,e.required=t.isRequired||!1;const p=document.createElement("option");p.value="",p.textContent=t.placeholder||"Selecciona una opción",e.appendChild(p),t.choices.forEach(v=>{const u=document.createElement("option");u.value=v.value,u.textContent=v.text,e.appendChild(u)}),n.appendChild(e)}a.appendChild(n),setTimeout(()=>{n.style.transition="all 0.5s ease-out",n.style.opacity="1",n.style.transform="translateY(0)"},100+d*100)});const i=document.createElement("div");i.className="form-actions",i.style.opacity="0",i.style.transform="translateY(20px)";const r=document.createElement("button");r.type="submit",r.className="btn primary-btn",r.innerHTML=`<span>${m.button?.text||"Enviar"}</span>`,i.appendChild(r),a.appendChild(i),setTimeout(()=>{i.style.transition="all 0.5s ease-out",i.style.opacity="1",i.style.transform="translateY(0)"},600);const o=document.createElement("div");o.id="formMessage",o.className="form-message",o.style.display="none",a.addEventListener("submit",async t=>{t.preventDefault(),r.innerHTML='<span class="spinner-small"></span> Enviando...',r.disabled=!0,r.classList.add("loading");const d=new FormData(a),n={form_id:String(E)};for(let[s,e]of d.entries())if(e){const p=s.replace("input_","");n[p]=e.toString()}try{const s=await fetch("/api/gravity-form",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input_values:n})});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);o.className="form-message success",o.innerHTML=`
            <div class="success-icon">✓</div>
            <p>¡Mensaje enviado correctamente!</p>
            <p>Te responderemos pronto.</p>
          `,o.style.display="block",a.reset(),o.scrollIntoView({behavior:"smooth",block:"center"}),a.style.transition="all 0.5s ease-out",a.style.opacity="0.5",a.style.transform="scale(0.98)"}catch(s){console.error("Error:",s),o.className="form-message error",o.innerHTML=`
            <div class="error-icon">✕</div>
            <p>No se pudo enviar el formulario automáticamente.</p>
            <p>Por favor, envíanos un email a: <a href="mailto:hola@vinylstation.com">hola@vinylstation.com</a></p>
          `,o.style.display="block"}finally{r.innerHTML=`<span>${m.button?.text||"Enviar"}</span>`,r.disabled=!1,r.classList.remove("loading")}}),l.innerHTML="",l.appendChild(a),l.appendChild(o),l.classList.remove("form-loading")}catch(c){console.error("Error cargando formulario:",c),y&&(y.style.display="none"),h&&(h.style.display="block")}});
